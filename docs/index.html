<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Evaluation of Indicator Performances for Assessing Ecosystem States • INDperform</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><link href="extra.css" rel="stylesheet">
<meta property="og:title" content="Evaluation of Indicator Performances for Assessing Ecosystem States">
<meta property="og:description" content="An implementation of the 7-step approach suggested by Otto et al. 
    (2018) &lt;doi:10.1016/j.ecolind.2017.05.045&gt; to validate ecological state indicators
    and to select a suite of complimentary and well performing indicators. 
    This suite can be then used to assess the current state of the system 
    in comparison to a reference period. However, the tools in this package 
    are very generic and can be used to test any type of indicator (e.g. social 
    or economic indicators).">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">INDperform</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.2.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    Datasets &amp; Functions
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-book"></span>
     
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://doi.org/10.1016/j.ecolind.2017.05.045">Quantitative framework for selecting and validating food web indicators</a>
    </li>
    <li>
      <a href="https://raw.githubusercontent.com/saskiaotto/cheatsheets/476bad4a8876939a7b3e1784a5bf61567ed4a715/Cheatsheet_INDperform_v0.1.0.pdf">Indperform cheatsheet</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">
    <span class="fa fa-newspaper-o"></span>
     
    News
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/saskiaotto/INDperform">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="mailto:saskia.otto@uni-hamburg.de">
    <span class="fa fa-send"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="indperform-" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#indperform-" class="anchor"></a>INDperform <img src="reference/figures/logo.png" align="right" width="100" height="112">
</h1></div>
<!-- badges: start -->

<p>INDperform is an R package for validating the performance of ecological state indicators and assessing the ecological status based on a suite of indicators.</p>
<p>Finding suitable state indicators (IND) is challenging and cumbersome in stochastic and complex ecological systems. Particularly, features associated with the indicator’s performance such as sensitivity or robustness are often neglected due to the lack of quantitative validation tools. INDperform implements a novel quantitative framework for selecting and validating the performance of state indicators tailored to meet regional conditions and specific management needs as described in Otto <em>et al.</em> (2018). The package builds upon the tidy data principles and offers functions to</p>
<ul>
<li>identify temporal indicator changes,</li>
<li>model relationships to pressures while taking non-linear responses and temporal autocorrelation into account, and to</li>
<li>quantify the robustness of these models.</li>
</ul>
<p>These functions can be executed on any number of indicators and pressures. Based on these analyses and a scoring scheme for selected criteria the individual performances can be quantified, visualized, and compared. The combination of tools provided in this package can help making state indicators operational under given management schemes such as the EU Marine Strategy Framework Directive.</p>
<p><br></p>
<p><a href="https://marinedatascience.co"> <img src="reference/figures/mds_logo_text_144dpi.png" height="40" align="left"></a></p>
<p><strong><em>INDperform is maintained and mainly developed by <a href="https://saskiaotto.de">Saskia Otto</a>, <a href="https://www.biologie.uni-hamburg.de/en/einrichtungen/imf.html">Institute of Marine Ecosystem and Fisheries Science</a> (IMF), University of Hamburg, Germany</em></strong></p>
<hr>
<div id="-latest-news" class="section level2">
<h2 class="hasAnchor">
<a href="#-latest-news" class="anchor"></a><i class="fa fa-newspaper-o" aria-hidden="true"></i> Latest News</h2>
<p>In Version 0.2.2 some adjustments were made to account for changes in packages INDperform depends on and a minor bug fixed in the NRMSE model prediction plot. Some of the plotting functions include now also titles in the individual panels. A data validation routine was added to check for unwanted characters in indicator or pressure names which caused models to not build. For more details see the <a href="https://saskiaotto.github.io/INDperform/news/index.html">NEWS</a> file.</p>
<hr>
<p>In Version 0.2.1, a minor bug with different internal test results under different R versions was fixed by modifying some tests. But this bug did not affect the modelling results or performance of the previous version.</p>
<hr>
<p>Version 0.2.0 has been released on CRAN 2019-02-10! The new version includes a few internal changes as adjustments to updated packages it depends on. Major changes include a new NRMSE calculation based on the standard deviation and back-transformation (see <a href="https://www.marinedatascience.co/blog/2019/01/07/normalizing-the-rmse/" class="uri">https://www.marinedatascience.co/blog/2019/01/07/normalizing-the-rmse/</a> for the motivation), an NRMSE stand-alone function (<code><a href="reference/nrmse.html">nrmse()</a></code>) and a function that allows the calculation of the distance matrix averaged across groups (i.e. a weighted distance matrix) (<code><a href="reference/dist_sc_group.html">dist_sc_group()</a></code>). For more information see the <a href="https://github.com/saskiaotto/INDperform/blob/master/NEWS.md">news</a> file.</p>
<hr>
</div>
<div id="cheat-sheet" class="section level2">
<h2 class="hasAnchor">
<a href="#cheat-sheet" class="anchor"></a>Cheat sheet</h2>
<p><em>(last update 01/2020)</em></p>
<p><a href="https://github.com/saskiaotto/cheatsheets/raw/master/Cheatsheet_INDperform_v0.2.2.pdf"><img src="reference/figures/INDperform_cheatsheet.png" width="900" height="252"></a><br>
____________________________________________________________________________________</p>
</div>
<div id="-getting-started" class="section level2">
<h2 class="hasAnchor">
<a href="#-getting-started" class="anchor"></a><i class="fas fa-running" aria-hidden="true"></i> Getting started</h2>
<p>Install the latest version from CRAN or the development version from GitHub:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"INDperform"</span><span class="op">)</span>

<span class="co"># install.packages("devtools")</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"saskiaotto/INDperform"</span><span class="op">)</span></code></pre></div>
<p>INDperform offers function that can be applied individually to some extent but mostly build upon each other to follow the 7-step process proposed in Otto <em>et al.</em> (2018) (see also the package’s cheatsheet for detailed instructions). For demonstration purposes the package provides a dataset of food web indicators and pressure variables in the Central Baltic Sea (modified from Otto <em>et al.</em>, 2018).</p>
<p>This is a suggested workflow demonstrated on the example data included in the package:</p>
</div>
<div id="workflow" class="section level2">
<h2 class="hasAnchor">
<a href="#workflow" class="anchor"></a>Workflow</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://saskiaotto.github.io/INDperform/">INDperform</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span>

<span class="co"># Using the demo data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">ind_ex</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">press_ex</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">press_type_ex</span><span class="op">)</span>
<span class="co"># Scoring template:</span>
<span class="va">crit_scores_tmpl</span></code></pre></div>
<div id="a-trend-modeling" class="section level3">
<h3 class="hasAnchor">
<a href="#a-trend-modeling" class="anchor"></a>A. Trend modeling</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m_trend</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/model_trend.html">model_trend</a></span><span class="op">(</span>ind_tbl <span class="op">=</span> <span class="va">ind_ex</span><span class="op">[</span> ,<span class="op">-</span><span class="fl">1</span><span class="op">]</span>,
  time <span class="op">=</span> <span class="va">ind_ex</span><span class="op">$</span><span class="va">Year</span><span class="op">)</span>

<span class="co"># Model diagnostics</span>
<span class="va">pd</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/plot_diagnostics.html">plot_diagnostics</a></span><span class="op">(</span>model_list <span class="op">=</span> <span class="va">m_trend</span><span class="op">$</span><span class="va">model</span><span class="op">)</span>
<span class="va">pd</span><span class="op">$</span><span class="va">all_plots</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="co"># first indicator</span>
<span class="co"># check for outliers in all models</span>
<span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span>grobs <span class="op">=</span> <span class="va">pd</span><span class="op">$</span><span class="va">cooks_dist</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> 
<span class="co"># check normality in all models</span>
<span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span>grobs <span class="op">=</span> <span class="va">pd</span><span class="op">$</span><span class="va">qq_plot</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="co"># check homogeneity in all models</span>
<span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span>grobs <span class="op">=</span> <span class="va">pd</span><span class="op">$</span><span class="va">resid_plot</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="co"># check for autocorrelation in all models</span>
<span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span>grobs <span class="op">=</span> <span class="va">pd</span><span class="op">$</span><span class="va">acf_plot</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="co"># check for partial autocorrelation in all models</span>
<span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span>grobs <span class="op">=</span> <span class="va">pd</span><span class="op">$</span><span class="va">pacf_plot</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>

<span class="co"># Save diagnostic plots per indicator in a pdf</span>
<span class="va">ml</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">marrangeGrob</a></span><span class="op">(</span>grobs <span class="op">=</span> <span class="va">pd</span><span class="op">$</span><span class="va">all_plots</span>, ncol <span class="op">=</span> <span class="fl">1</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="fu">ggsave</span><span class="op">(</span><span class="st">"Trend_diagnostics.pdf"</span>, <span class="va">ml</span>, height <span class="op">=</span> <span class="fl">8</span>, width <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>

<span class="co"># Inspect trends</span>
<span class="va">pt</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/plot_trend.html">plot_trend</a></span><span class="op">(</span><span class="va">m_trend</span><span class="op">)</span>
<span class="va">pt</span><span class="op">$</span><span class="va">TZA</span> <span class="co"># shows trend of TZA indicator</span>
<span class="co"># show all together</span>
<span class="va">ml</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span>grobs <span class="op">=</span> <span class="va">pt</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="va">ml</span>
<span class="co"># save as pdf</span>
<span class="fu">ggsave</span><span class="op">(</span><span class="st">"Trend_plots.pdf"</span>, <span class="va">ml</span>, height <span class="op">=</span> <span class="fl">12</span>, width <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>
<span class="co"># show only significant trends</span>
<span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span>
  grobs <span class="op">=</span> <span class="va">pt</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">m_trend</span><span class="op">$</span><span class="va">p_val</span> <span class="op">&lt;=</span> <span class="fl">0.05</span><span class="op">)</span><span class="op">]</span>,
  ncol <span class="op">=</span> <span class="fl">2</span>
    <span class="op">)</span></code></pre></div>
</div>
<div id="b-indicator-response-modeling" class="section level3">
<h3 class="hasAnchor">
<a href="#b-indicator-response-modeling" class="anchor"></a>B. Indicator response modeling</h3>
<div id="b1-initialize-data" class="section level4">
<h4 class="hasAnchor">
<a href="#b1-initialize-data" class="anchor"></a>B.1 Initialize data</h4>
<p>Combine IND with pressures and select training and test period –&gt; default is training data = first 90% of obs)</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>dat_init &lt;-<span class="st"> </span><span class="kw">ind_init</span>(<span class="dt">ind_tbl =</span> ind_ex[ ,<span class="op">-</span><span class="dv">1</span>],</span>
<span id="cb4-2"><a href="#cb4-2"></a>  <span class="dt">press_tbl =</span> press_ex[ ,<span class="op">-</span><span class="dv">1</span>], <span class="dt">time =</span> ind_ex<span class="op">$</span>Year,</span>
<span id="cb4-3"><a href="#cb4-3"></a>    <span class="dt">train =</span> <span class="fl">0.9</span>, <span class="dt">random =</span> <span class="ot">FALSE</span>)</span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="st">````</span></span>
<span id="cb4-5"><a href="#cb4-5"></a></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="co">#### B.2a Model responses using simple GAMs (using default settings here)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m_gam</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/model_gam.html">model_gam</a></span><span class="op">(</span>init_tbl <span class="op">=</span> <span class="va">dat_init</span>, k <span class="op">=</span> <span class="fl">5</span>,
    family <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html">gaussian</a></span><span class="op">(</span><span class="op">)</span>, excl_outlier <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>

<span class="co"># Model diagnostics</span>
<span class="va">pd</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/plot_diagnostics.html">plot_diagnostics</a></span><span class="op">(</span>model_list <span class="op">=</span> <span class="va">m_gam</span><span class="op">$</span><span class="va">model</span><span class="op">)</span>  <span class="co"># (might take a while)</span>
<span class="va">ml</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">marrangeGrob</a></span><span class="op">(</span>grobs <span class="op">=</span> <span class="va">pd</span><span class="op">$</span><span class="va">all_plots</span>, ncol <span class="op">=</span> <span class="fl">1</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="fu">ggsave</span><span class="op">(</span><span class="st">"GAM_diagnostics.pdf"</span>, <span class="va">ml</span>, height <span class="op">=</span> <span class="fl">8</span>, width <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>

<span class="co"># Any outlier?</span>
<span class="va">m_gam</span><span class="op">$</span><span class="va">pres_outlier</span> <span class="op">%&gt;%</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/keep.html">compact</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>
<span class="co"># - get number of models with outliers detected</span>
<span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_lgl</a></span><span class="op">(</span><span class="va">m_gam</span><span class="op">$</span><span class="va">pres_outlier</span>, <span class="op">~</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">)</span>
<span class="co"># - which models and what observations?</span>
<span class="va">m_gam</span> <span class="op">%&gt;%</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">ind</span>, <span class="va">press</span>, <span class="va">pres_outlier</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_lgl</a></span><span class="op">(</span><span class="va">m_gam</span><span class="op">$</span><span class="va">pres_outlier</span>, .f <span class="op">=</span> <span class="va">is.null</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span><span class="va">pres_outlier</span><span class="op">)</span>

<span class="co"># Exclude outlier in models (using the returned model output tibble as selector)</span>
<span class="va">m_gam</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/model_gam.html">model_gam</a></span><span class="op">(</span>init_tbl <span class="op">=</span> <span class="va">dat_init</span>, excl_outlier <span class="op">=</span> <span class="va">m_gam</span><span class="op">$</span><span class="va">pres_outlier</span><span class="op">)</span>

<span class="co"># Any temporal autocorrelation (TAC)</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">m_gam</span><span class="op">$</span><span class="va">tac</span><span class="op">)</span>
<span class="co"># - which models</span>
<span class="va">m_gam</span> <span class="op">%&gt;%</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">ind</span>, <span class="va">press</span>, <span class="va">tac</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tac</span><span class="op">)</span></code></pre></div>
</div>
<div id="b2b-model-responses-using-simple-gamms-if-tac-is-present" class="section level4">
<h4 class="hasAnchor">
<a href="#b2b-model-responses-using-simple-gamms-if-tac-is-present" class="anchor"></a>B.2b Model responses using simple GAMMs if TAC is present</h4>
<p>(using same default settings here as for GAM, but not exclude observations yet)</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m_gamm</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/model_gamm.html">model_gamm</a></span><span class="op">(</span>init_tbl <span class="op">=</span> <span class="va">dat_init</span>,
  filter <span class="op">=</span> <span class="va">m_gam</span><span class="op">$</span><span class="va">tac</span><span class="op">)</span> <span class="co"># (apply GAMM only to rows where TAC detected)</span>

<span class="co"># Again, any outlier?</span>
<span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_lgl</a></span><span class="op">(</span><span class="va">m_gamm</span><span class="op">$</span><span class="va">pres_outlier</span>, <span class="op">~</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Select best GAMM from different correlation structures</span>
<span class="co"># (based on AIC)</span>
<span class="va">best_gamm</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/select_model.html">select_model</a></span><span class="op">(</span>gam_tbl <span class="op">=</span> <span class="va">m_gam</span>, gamm_tbl <span class="op">=</span> <span class="va">m_gamm</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/View.html">View</a></span><span class="op">(</span><span class="va">best_gamm</span><span class="op">)</span>

<span class="co"># Still any temporal autocorrelation?</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">best_gamm</span><span class="op">$</span><span class="va">tac</span><span class="op">)</span> 
<span class="co"># - which models</span>
<span class="va">best_gamm</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">ind</span>, <span class="va">press</span>, <span class="va">tac</span>, <span class="va">corrstruc</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">tac</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">100</span><span class="op">)</span>

<span class="co"># Inspect diagnostic plots of best GAMMs</span>
<span class="va">pd</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/plot_diagnostics.html">plot_diagnostics</a></span><span class="op">(</span>model_list <span class="op">=</span> <span class="va">best_gamm</span><span class="op">$</span><span class="va">model</span><span class="op">)</span>
<span class="va">ml</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">marrangeGrob</a></span><span class="op">(</span>grobs <span class="op">=</span> <span class="va">pd</span><span class="op">$</span><span class="va">all_plots</span>, ncol <span class="op">=</span> <span class="fl">1</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="fu">ggsave</span><span class="op">(</span><span class="st">"bestGAMM_diagnostics.pdf"</span>, <span class="va">ml</span>, height <span class="op">=</span> <span class="fl">8</span>, width <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></code></pre></div>
</div>
<div id="b2c-merge-gam-and-gamms" class="section level4">
<h4 class="hasAnchor">
<a href="#b2c-merge-gam-and-gamms" class="anchor"></a>B.2c Merge GAM and GAMMs</h4>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m_merged</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/merge_models.html">merge_models</a></span><span class="op">(</span><span class="va">m_gam</span><span class="op">[</span><span class="va">m_gam</span><span class="op">$</span><span class="va">tac</span> <span class="op">==</span> <span class="cn">FALSE</span>, <span class="op">]</span>, <span class="va">best_gamm</span><span class="op">)</span>

<span class="co"># View sign. models</span>
<span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">m_merged</span>, <span class="va">p_val</span> <span class="op">&lt;=</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/View.html">View</a></span><span class="op">(</span><span class="op">)</span> </code></pre></div>
<div id="nrmse-adjustments-on-transformed-inds" class="section level5">
<h5 class="hasAnchor">
<a href="#nrmse-adjustments-on-transformed-inds" class="anchor"></a>NRMSE adjustments on transformed INDs</h5>
<p>To allow a comparison of the model performance across transformed and untransformed indicators using the Normalized Root Mean Square error (NRMSE), the NRMSE has to be calculated on the original scale. The function <code><a href="reference/nrmse.html">nrmse()</a></code> (applied to a single model) or the wrapper function <code><a href="reference/calc_nrmse.html">calc_nrmse()</a></code> (applied to a list of models) take as argument the transformation type that was applied to each indicator prior to the analysis and compute the NRMSE on the back-transformed observations and predictions (see also <a href="https://marinedatascience.co/blog/2019/01/07/normalizing-the-rmse/" class="uri">https://marinedatascience.co/blog/2019/01/07/normalizing-the-rmse/</a>).</p>
<p>In the example dataset <code>ind_ex</code> all indicators except for <code>MS</code> and <code>rZPPP</code> have been ln-transformed. So let’s calculated a corrected NRMSE for these INDs using the wrapper function <code><a href="reference/calc_nrmse.html">calc_nrmse()</a></code>. To get the respective ids in the model output tibble for selection and replacement, we will use the helper function <code><a href="reference/find_id.html">find_id()</a></code> (the function returns a subset of the model tibble and the <code>id</code> column can be then used as index).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sel</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/find_id.html">find_id</a></span><span class="op">(</span>
    mod_tbl <span class="op">=</span> <span class="va">m_merged</span>, 
    ind_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"TZA"</span>,<span class="st">"rCC"</span>,<span class="st">"Cops"</span>, <span class="st">"Micro"</span>, <span class="st">"Sprat"</span>,
        <span class="st">"Herring"</span>, <span class="st">"Stickle"</span>, <span class="st">"Cod"</span>, <span class="st">"SPF"</span>, <span class="st">"LPF"</span><span class="op">)</span>
<span class="op">)</span><span class="op">$</span><span class="va">id</span>

<span class="va">m_merged</span><span class="op">$</span><span class="va">nrmse</span><span class="op">[</span><span class="va">sel</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/calc_nrmse.html">calc_nrmse</a></span><span class="op">(</span>
    press <span class="op">=</span> <span class="va">ind_init_ex</span><span class="op">$</span><span class="va">press_test</span><span class="op">[</span><span class="va">sel</span><span class="op">]</span>, 
    ind <span class="op">=</span> <span class="va">ind_init_ex</span><span class="op">$</span><span class="va">ind_test</span><span class="op">[</span><span class="va">sel</span><span class="op">]</span>,
    model <span class="op">=</span> <span class="va">m_merged</span><span class="op">$</span><span class="va">model</span><span class="op">[</span><span class="va">sel</span><span class="op">]</span>, 
    transformation <span class="op">=</span> <span class="st">"log"</span>
<span class="op">)</span></code></pre></div>
</div>
</div>
<div id="b3-calculate-derivatives-of-significant-non-linear-responses" class="section level4">
<h4 class="hasAnchor">
<a href="#b3-calculate-derivatives-of-significant-non-linear-responses" class="anchor"></a>B.3 Calculate derivatives of (significant) non-linear responses</h4>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m_calc</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/calc_deriv.html">calc_deriv</a></span><span class="op">(</span>init_tbl <span class="op">=</span> <span class="va">dat_init</span>, mod_tbl <span class="op">=</span> <span class="va">m_merged</span>,
    sign_level <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></code></pre></div>
</div>
<div id="b4-test-for-pressure-interactions-in-significant-models-onlydefault" class="section level4">
<h4 class="hasAnchor">
<a href="#b4-test-for-pressure-interactions-in-significant-models-onlydefault" class="anchor"></a>B.4 Test for pressure interactions (in significant models only=default)</h4>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">it</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/select_interaction.html">select_interaction</a></span><span class="op">(</span>mod_tbl <span class="op">=</span> <span class="va">m_calc</span><span class="op">)</span>
<span class="co"># (creates combinations to test for)</span>

<span class="va">m_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/test_interaction.html">test_interaction</a></span><span class="op">(</span>init_tbl <span class="op">=</span> <span class="va">dat_init</span>, mod_tbl <span class="op">=</span> <span class="va">m_calc</span>,
     interactions <span class="op">=</span> <span class="va">it</span>, sign_level <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>

<span class="co"># Inspect diagnostics of threshold models</span>
<span class="va">pd_thresh</span> <span class="op">&lt;-</span> <span class="va">m_all</span><span class="op">$</span><span class="va">thresh_models</span> <span class="op">%&gt;%</span>
    <span class="co"># flatten structure of nested threshold GAMs </span>
    <span class="fu">flatten</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="co"># and remove empty lists (where no threshold GAMs were applied (=NULL) </span>
    <span class="co"># or no threshold GAMs were better than the simple GAMs (=NA)</span>
    <span class="fu">keep</span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">is.list</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span>  <span class="op">%&gt;%</span>
    <span class="fu"><a href="reference/plot_diagnostics.html">plot_diagnostics</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">ml</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">marrangeGrob</a></span><span class="op">(</span>grobs <span class="op">=</span> <span class="va">pd_thresh</span><span class="op">$</span><span class="va">all_plots</span>, ncol <span class="op">=</span> <span class="fl">1</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="fu">ggsave</span><span class="op">(</span><span class="st">"thresholdGAM_diagnostics.pdf"</span>, <span class="va">ml</span>, height <span class="op">=</span> <span class="fl">8</span>, width <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>

<span class="co"># Look at the development of the generalized cross-validation value </span>
<span class="co"># at different thresholds level: the plot should show that the GCVV</span>
<span class="co"># of the final threshold should be clearly lower than of others </span>
<span class="co"># (you should see a single sharp trough, not at the edge)</span>
<span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span>grobs <span class="op">=</span> <span class="va">pd_thresh</span><span class="op">$</span><span class="va">gcvv_plot</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="co"># -&gt; some models do NOT show this (e.g. #4,6,7): here we could set the</span>
<span class="co">#  $interaction from TRUE to FALSE (for the scoring later) to ignore</span>
<span class="co"># this potentially spurious interaction found:</span>
<span class="va">m_all</span> <span class="op">&lt;-</span> <span class="va">m_all</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>
    interaction <span class="op">=</span> <span class="fu">case_when</span><span class="op">(</span>
    <span class="op">(</span><span class="va">ind</span> <span class="op">==</span> <span class="st">"Micro"</span> <span class="op">&amp;</span> <span class="va">press</span> <span class="op">==</span> <span class="st">"Fsprat"</span><span class="op">)</span> <span class="op">|</span>
        <span class="op">(</span><span class="va">ind</span> <span class="op">==</span> <span class="st">"Cod"</span> <span class="op">&amp;</span> <span class="va">press</span> <span class="op">==</span> <span class="st">"Fher"</span><span class="op">)</span> <span class="op">|</span> 
        <span class="op">(</span><span class="va">ind</span> <span class="op">==</span> <span class="st">"Cod"</span> <span class="op">&amp;</span> <span class="va">press</span> <span class="op">==</span> <span class="st">"Fcod"</span><span class="op">)</span> <span class="op">~</span> <span class="cn">FALSE</span>,
    <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">interaction</span><span class="op">)</span><span class="op">)</span>


<span class="co"># Show final significant GAM/GAMM (threshold GAM) plots:</span>
<span class="va">sel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">m_all</span><span class="op">$</span><span class="va">p_val</span> <span class="op">&lt;=</span> <span class="fl">0.05</span><span class="op">)</span>
<span class="va">pm</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/plot_model.html">plot_model</a></span><span class="op">(</span>init_tbl <span class="op">=</span> <span class="va">dat_init</span><span class="op">[</span><span class="va">sel</span>, <span class="op">]</span>, mod_tbl <span class="op">=</span> <span class="va">m_all</span><span class="op">[</span><span class="va">sel</span>, <span class="op">]</span><span class="op">)</span>
<span class="co"># Save all sign. indicator plots</span>
<span class="va">ml</span> <span class="op">&lt;-</span> <span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">marrangeGrob</a></span><span class="op">(</span>grobs <span class="op">=</span> <span class="va">pm</span><span class="op">$</span><span class="va">all_plots</span>, ncol <span class="op">=</span> <span class="fl">1</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="st">"Final_model_results.pdf"</span>, <span class="va">ml</span>, height <span class="op">=</span> <span class="fl">10</span>, width <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="c-scoring-based-on-model-output" class="section level3">
<h3 class="hasAnchor">
<a href="#c-scoring-based-on-model-output" class="anchor"></a>C. Scoring based on model output</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/scoring.html">scoring</a></span><span class="op">(</span>trend_tbl <span class="op">=</span> <span class="va">m_trend</span>, mod_tbl <span class="op">=</span> <span class="va">m_all</span>, 
    press_type <span class="op">=</span> <span class="va">press_type_ex</span><span class="op">)</span>

<span class="co"># Runs a shiny app to modify the score for the subcriterion 10.1:</span>
<span class="va">scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/expect_resp.html">expect_resp</a></span><span class="op">(</span>mod_tbl <span class="op">=</span> <span class="va">m_all</span>, scores_tbl <span class="op">=</span> <span class="va">scores</span><span class="op">)</span>

<span class="co"># Generate an easy to read summary from the nested scoring tibble</span>
<span class="va">sum_sc</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/summary_sc.html">summary_sc</a></span><span class="op">(</span><span class="va">scores</span><span class="op">)</span>
<span class="va">sum_sc</span></code></pre></div>
<div id="visualize-scores-with-a-spie-chart-using-the-summary-object-as-input" class="section level4">
<h4 class="hasAnchor">
<a href="#visualize-scores-with-a-spie-chart-using-the-summary-object-as-input" class="anchor"></a>Visualize scores with a spie chart (using the summary object as input)</h4>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">spie</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/plot_spiechart.html">plot_spiechart</a></span><span class="op">(</span><span class="va">sum_sc</span>,
    lab_size <span class="op">=</span> <span class="fl">4</span>, title_size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>
<span class="va">spie</span><span class="op">$</span><span class="va">TZA</span> <span class="co"># shows the spiechart of the indicator TZA</span>
<span class="co"># show all:</span>
<span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span>grobs <span class="op">=</span> <span class="va">spie</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
</div>
<div id="cluster-analysis-based-on-scores-to-identify-redundanciescomplementarities" class="section level4">
<h4 class="hasAnchor">
<a href="#cluster-analysis-based-on-scores-to-identify-redundanciescomplementarities" class="anchor"></a>Cluster analysis based on scores to identify redundancies/complementarities</h4>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">scores_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/dist_sc.html">dist_sc</a></span><span class="op">(</span><span class="va">sum_sc</span><span class="op">$</span><span class="va">scores_matrix</span><span class="op">)</span>
<span class="va">scores_clust</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/clust_sc.html">clust_sc</a></span><span class="op">(</span><span class="va">scores_dist</span><span class="op">)</span>
<span class="fu"><a href="reference/plot_clust_sc.html">plot_clust_sc</a></span><span class="op">(</span><span class="va">scores_clust</span><span class="op">)</span>

<span class="co"># Weighted cluster analysis where distance matrix is averaged across group scores</span>
<span class="co"># (see ?dist_sc_group for more infos)</span>
<span class="va">sc_mat</span> <span class="op">&lt;-</span> <span class="va">sum_sc</span><span class="op">$</span><span class="va">scores_matrix</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="va">sc_mat</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, <span class="co"># crit 8 and 11</span>
    <span class="va">sc_mat</span><span class="op">[</span>,<span class="fl">3</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span>, <span class="co"># crit 9 and 10 - fisheries</span>
    <span class="va">sc_mat</span><span class="op">[</span>,<span class="fl">9</span><span class="op">:</span><span class="fl">12</span><span class="op">]</span>, <span class="co"># crit 9 and 10 - nutrients</span>
    <span class="va">sc_mat</span><span class="op">[</span>,<span class="fl">13</span><span class="op">:</span><span class="fl">16</span><span class="op">]</span> <span class="co"># crit 9 and 10 - climate</span>
    <span class="op">)</span> 
<span class="va">scores_w_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/dist_sc_group.html">dist_sc_group</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="va">scores_w_clust</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/clust_sc.html">clust_sc</a></span><span class="op">(</span><span class="va">scores_w_dist</span><span class="op">)</span>
<span class="fu"><a href="reference/plot_clust_sc.html">plot_clust_sc</a></span><span class="op">(</span><span class="va">scores_w_clust</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="d-state-assessment-based-on-final-suite-of-ind" class="section level3">
<h3 class="hasAnchor">
<a href="#d-state-assessment-based-on-final-suite-of-ind" class="anchor"></a>D. State assessment based on final suite of IND</h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Select subset of complementary indicators and exclude any NAs, e.g.</span>
<span class="va">ind_noNA</span> <span class="op">&lt;-</span> <span class="fu">drop_na</span><span class="op">(</span><span class="va">ind_ex</span><span class="op">)</span>
<span class="va">ind_sub</span> <span class="op">&lt;-</span> <span class="va">ind_noNA</span><span class="op">[</span> , <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">12</span>,<span class="fl">13</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<div id="d1-euclidean-distance-in-state-space" class="section level4">
<h4 class="hasAnchor">
<a href="#d1-euclidean-distance-in-state-space" class="anchor"></a>D.1 Euclidean distance in state space</h4>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>ed &lt;-<span class="st"> </span><span class="kw">statespace_ed</span>(<span class="dt">x =</span> ind_sub, <span class="dt">time =</span> ind_noNA<span class="op">$</span>Year, <span class="dt">ref_time =</span> ind_noNA<span class="op">$</span>Year[<span class="dv">1</span>] )</span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="kw">plot_statespace_ed</span>(ed) </span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="st">````</span></span>
<span id="cb15-4"><a href="#cb15-4"></a></span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="co">#### D.2 Convex hull of state space between 2 indicators </span></span>
<span id="cb15-6"><a href="#cb15-6"></a>( or between <span class="dv">2</span> variables from a multivariate analysis)</span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ch</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/statespace_ch.html">statespace_ch</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">ind_sub</span><span class="op">$</span><span class="va">SPF</span>, y <span class="op">=</span> <span class="va">ind_sub</span><span class="op">$</span><span class="va">LPF</span>, time <span class="op">=</span> <span class="va">ind_noNA</span><span class="op">$</span><span class="va">Year</span>,
    period_ref <span class="op">=</span> <span class="fl">1984</span><span class="op">:</span><span class="fl">1986</span>, period_current <span class="op">=</span> <span class="fl">2004</span><span class="op">:</span><span class="fl">2008</span><span class="op">)</span>

<span class="fu"><a href="reference/plot_statespace_ch.html">plot_statespace_ch</a></span><span class="op">(</span><span class="va">ch</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"Small Predatory Fish"</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Large Predatory Fish"</span><span class="op">)</span></code></pre></div>
<hr>
<div id="note-for-spatial-data" class="section level5">
<h5 class="hasAnchor">
<a href="#note-for-spatial-data" class="anchor"></a>NOTE FOR SPATIAL DATA:</h5>
<p>All functions are tailored to indicator time series. <strong>Spatial data</strong> and spatial autocorrelation testing is currently not included. However, if you have spatial data you could still use all functions except for <code><a href="reference/model_gamm.html">model_gamm()</a></code> as it incorporates only temporal autocorrelation structures (AR and ARMA). Simply do the following and use as <code>time</code> vector in <code><a href="reference/ind_init.html">ind_init()</a></code> an integer variable with <strong>consecutive</strong> numbers (with no gaps!) representing your different stations.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### Use of station numbers instead of time vector</span>
<span class="va">station_id</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">your_indicator_dfr</span><span class="op">)</span> 
<span class="va">dat_init</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ind_init.html">ind_init</a></span><span class="op">(</span>ind_tbl <span class="op">=</span> <span class="va">your_indicator_dfr</span>,
  press_tbl <span class="op">=</span> <span class="va">your_pressure_dfr</span>, time <span class="op">=</span> <span class="va">station_id</span><span class="op">)</span></code></pre></div>
<hr>
</div>
</div>
</div>
</div>
<div id="-details" class="section level2">
<h2 class="hasAnchor">
<a href="#-details" class="anchor"></a><i class="fas fa-info" aria-hidden="true"></i> Details</h2>
<div id="validation-of-ind-performances" class="section level3">
<h3 class="hasAnchor">
<a href="#validation-of-ind-performances" class="anchor"></a>Validation of IND performances</h3>
<div id="modeling-ind-trends-and-responses-to-single-pressures" class="section level4">
<h4 class="hasAnchor">
<a href="#modeling-ind-trends-and-responses-to-single-pressures" class="anchor"></a>Modeling IND trends and responses to single pressures</h4>
<p>Each IND is modeled as a function of time or a single pressure variable using Generalized Additive Models (GAMs) (based on the mgcv package).</p>
<ul>
<li>
<code><a href="reference/model_trend.html">model_trend()</a></code> models the long-term trend of each IND and returns a tibble with all GAM outputs, the model object, and predicted time series per IND.</li>
<li>
<code><a href="reference/ind_init.html">ind_init()</a></code> combines the time vector and the IND and press data into one tibble with defined training and test observations. All INDs are combined with all pressures.</li>
<li>
<code><a href="reference/model_gam.html">model_gam()</a></code> applies GAMs to each IND~pressure combination created in <code><a href="reference/ind_init.html">ind_init()</a></code> and returns a tibble including the model output and diagnostics.</li>
<li>
<code><a href="reference/model_gamm.html">model_gamm()</a></code> accounts for temporal autocorrelation in the time series by including correlation structures in the model (using Generalized Additive Mixed Models (GAMMs): AR1, AR2, ARMA1.1, ARMA2.1, ARMA1.2.</li>
<li>
<code><a href="reference/select_model.html">select_model()</a></code> selects for each IND~pressure the best correlation structure computed with <code><a href="reference/model_gamm.html">model_gamm()</a></code> based on the Akaike Information Criterion.</li>
<li>
<code><a href="reference/merge_models.html">merge_models()</a></code> merges any 2 model output tibbles.</li>
<li>
<code><a href="reference/calc_deriv.html">calc_deriv()</a></code> calculates for non-linear responses the 1st derivative of the smoothing function and the proportion of pressure range in which the IND shows a response. Output is input tibble with few additional variables, incl. mean and confidence interval of smoothing function and derivatives from bootstrapped GAMs.</li>
<li>
<code><a href="reference/test_interaction.html">test_interaction()</a></code> tests for each significant GAM(M) whether a selection of pressure variables modifies the IND response to the original pressure using a threshold-GAM formulation. Output is input tibble with few additional variables.</li>
</ul>
<p>To show the model diagnostics or complete model results</p>
<ul>
<li>
<code><a href="reference/plot_diagnostics.html">plot_diagnostics()</a></code> creates a tibble with 6 individual plots (ggplot2 objects) and one combined plot (cowplot object):
<ul>
<li>
<code>$cooks_dist</code> shows the cooks distance of all observations.</li>
<li>
<code>$acf_plot</code> shows the autocorrelation function.</li>
<li>
<code>$pacf_plot</code> shows the partial autocorrelation function.</li>
<li>
<code>$resid_plot</code> shows residuals vs. fitted values.</li>
<li>
<code>$qq_plot</code> shows the quantile-quantile plot for normality.</li>
<li>
<code>$gcvv_plot</code> shows the development of the generalized cross-validation value at different thresholds level of the modifying pressure variable in the threshold-GAM.</li>
<li>
<code>$all_plots</code> shows all five (six if threshold-GAM) plots together.</li>
</ul>
</li>
<li>
<code><a href="reference/plot_trend.html">plot_trend()</a></code> creates a list of ggplot2 objects with all IND trends from the input tibble.</li>
<li>
<code><a href="reference/plot_model.html">plot_model()</a></code> creates a tibble with 4 individual plots (ggplot2 objects) and one combined plot (cowplot object):
<ul>
<li>
<code>$response_plot</code> shows the observed and predicted IND response to the single pressure (based on the training data).</li>
<li>
<code>$predict_plot</code> shows the test (and train) observations predicted from the model. Included is the normalized root mean square error (NRMSE) for the test data as a measure of model robustness.</li>
<li>
<code>$deriv_plot</code> shows the first derivative of non-linear IND~pressure response curves and the proportion of the pressure range where the IND shows no further significant change (i.e., slope approximates zero).</li>
<li>
<code>$thresh_plot</code> shows the IND response curve under a low and high regime of an interacting 2nd pressure variable.</li>
<li>
<code>$all_plots</code> shows all plots together.</li>
</ul>
</li>
</ul>
</div>
<div id="scoring-ind-performance-based-on-model-output" class="section level4">
<h4 class="hasAnchor">
<a href="#scoring-ind-performance-based-on-model-output" class="anchor"></a>Scoring IND performance based on model output</h4>
<p>Among the 16 common indicator selection criteria, five criteria relate to the indicator’s performances and require time series for their evaluation, i.e.</p>
<ol>
<li>Development reflects ecosystem change caused by variation in manageable pressure(s)</li>
<li>Sensitive or responsive to pressures</li>
<li>Robust, i.e. responses in a predictive fashion, and statistically sound</li>
<li>Links to management measures (responsiveness and specificity)</li>
<li>Relates where appropriate to other indicators but is not redundant</li>
</ol>
<p>As these are subject to the quality of the underlying data, a thorough determination of whether the indicator as implemented meets the expected requirements is needed. In this package, the scoring scheme for these criteria as proposed by Otto <em>et al.</em> (2018) serves as basis for the quantification of the IND performance. Sensitivity (criterion 9) and robustness (criterion 10) are specified into more detailed sub-criteria to allow for quantification based on statistical models and rated individually for every potential pressure that might affect the IND directly or indirectly.</p>
<p>However, the scoring scheme can easily be adapted to any kind of state indicator and management scheme by modifying the scores, the weighting of scores or by removing (sub)criteria.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">crit_scores_tmpl</span></code></pre></div>
<p>This table contains the scores and weights for each (sub-)criterion. It includes also the variables from the model output tibbles on which each(sub)criterion is based on as well as the condition to determine the actual score. <code>crit_scores_tmpl</code> is set as default in the <code><a href="reference/scoring.html">scoring()</a></code> function and, if needed, should be modified prior to using the function.</p>
<ul>
<li>
<code><a href="reference/scoring.html">scoring()</a></code> models the long-term trend of each IND and returns a tibble with all GAM outputs, the model object, and predicted time series per IND.</li>
<li>
<code><a href="reference/expect_resp.html">expect_resp()</a></code> runs a shiny app to modify manually the score for the sub-criterion 10.1 (IND response as expected) based on the response curves (default score 1 for neutral / no expectation).</li>
</ul>
<p align="center">
</p>
<p><img src="reference/figures/shiny_app_expect_resp.png" width="700"></p>

<p><br></p>
<ul>
<li>
<code><a href="reference/summary_sc.html">summary_sc()</a></code> provides a user-friendly summary of the scoring output tibble.</li>
<li>
<code><a href="reference/plot_spiechart.html">plot_spiechart()</a></code> generates a list of ggplot2 objects (one for each IND). A spie chart superimposes a normal pie chart with a modified polar area chart to permit the comparison of two sets of related data.</li>
</ul>
<p align="center">
</p>
<p><img src="reference/figures/README_spiechart.png" width="400" height="300"></p>

<p><br></p>
<p><strong>Examining redundancies and selecting robust indicator suites</strong></p>
<ul>
<li>
<code><a href="reference/dist_sc.html">dist_sc()</a></code> Calculates a (Euclidean) distance matrix based on all scores.</li>
<li>
<code><a href="reference/clust_sc.html">clust_sc()</a></code> applies a hierarchical group-average cluster analysis, returns a <code>hclust</code> object and prints the Gower distance and Cophonetic correlation coefficient.</li>
<li>
<code><a href="reference/plot_clust_sc.html">plot_clust_sc()</a></code> creates a dendrogram (ggplot2 object) from the cluster analysis.</li>
</ul>
</div>
</div>
<div id="assessment-of-current-state-status" class="section level3">
<h3 class="hasAnchor">
<a href="#assessment-of-current-state-status" class="anchor"></a>Assessment of current state status</h3>
<p>Two approaches based on trajectories in state space to determine the current state of the system in comparison to an earlier period as reference using the selected IND suite (state space = n-dimensional space of possible locations of IND variables)</p>
<ol>
<li>
<p>Calculation of the <strong>Euclidean distance</strong> in state space of any dimensionality between each single year (or any other time step used) and a defined reference year.</p>
<ul>
<li>
<code><a href="reference/statespace_ed.html">statespace_ed()</a></code> calculates the Euclidean distance over time.</li>
<li>
<code><a href="reference/plot_statespace_ed.html">plot_statespace_ed()</a></code> creates a ggplot2 object of the Euclidean distance trend.</li>
</ul>
</li>
<li>
<p>Given the identification of a reference domain in state space, more recent observations might lie within or outside this domain. The <strong>convex hull</strong> is a multivariate measure derived from computational geometry representing the smallest convex set containing all the reference points in Euclidean plane or space. For visualization, only 2 dimensions considered (dimension reduction through e.g. Principal Component Analysis suggested).</p>
<ul>
<li>
<code><a href="reference/statespace_ch.html">statespace_ch()</a></code> calculates the convex hull for 2 defined periods (current and reference) in the x-y space (i.e. 2 IND or 2 Principal Components).</li>
<li>
<code><a href="reference/plot_statespace_ch.html">plot_statespace_ch()</a></code> creates a ggplot2 object showing all observed combinations in x-y space as well as the convex hull of both periods. The proportion of the recent time period within the reference space is additionally provided.</li>
</ul>
</li>
</ol>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=INDperform">https://​cloud.r-project.org/​package=INDperform</a>
</li>
<li>Browse source code at <br><a href="https://github.com/saskiaotto/INDperform/">https://​github.com/​saskiaotto/​INDperform/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/saskiaotto/INDperform/issues">https://​github.com/​saskiaotto/​INDperform/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>GPL</li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://saskiaotto.de">Saskia A. Otto</a> <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0001-7780-1322" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>
<a href="https://github.com/reneplonus">Rene Plonus</a> <br><small class="roles"> Author </small>  </li>
<li>
<a href="https://www.biologie.uni-hamburg.de/forschung/oekologie-biologische-ressourcen/maroeksysdyn/mitarbeiter/funk.html">Steffen Funk</a> <br><small class="roles"> Author </small>  </li>
<li>Alexander Keth <br><small class="roles"> Author </small>  </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/saskiaotto/INDperform/actions/workflows/check-full.yaml"><img src="https://github.com/saskiaotto/INDperform/actions/workflows/check-full.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://CRAN.R-project.org/package=INDperform"><img src="https://www.r-pkg.org/badges/version/INDperform" alt="CRAN status"></a></li>
<li><a href="https://cran.r-project.org/package=INDperform"><img src="https://cranlogs.r-pkg.org/badges/INDperform"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://saskiaotto.de">Saskia A. Otto</a>, <a href="https://github.com/reneplonus">Rene Plonus</a>, <a href="https://www.biologie.uni-hamburg.de/forschung/oekologie-biologische-ressourcen/maroeksysdyn/mitarbeiter/funk.html">Steffen Funk</a>, Alexander Keth.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
